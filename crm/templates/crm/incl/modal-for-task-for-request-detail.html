{% load static %}

<script class="datetime-flatpickr-script">
  // Инициализация flatpickr для форм
flatpickr('.flatpickr', {
    enableTime: true, 
    dateFormat: "d.m.Y H:i",
    time_24hr: true,
    locale: "ru",
    minDate: "{{ task.must_be_completed_by|date:'d.m.Y H:i' }}",
    defaultDate: "{{ task.must_be_completed_by|date:'d.m.Y H:i' }}"
});
</script>


<div class="modal fade" id="TaskForRequestDetailModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="TaskForRequestDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="TaskForRequestDetailModalLabel">{{ task.title }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <input type="hidden" name="notifications_status" value="{% if task.notifications %}ON{% else %}OFF{% endif %}">
        <div class="modal-body">
            <form id="updateTaskForRequest" action="{% url 'crm:task_for_request_detail' %}" method="post">
                {% csrf_token %}
                {% if task.expired %}<h5 style="color: red">Задача просрочена</h5>{% endif %}
                {% if task.is_completed %}<h5 style="color: green">Задача выполнена</h5>{% endif %}
                <input type="hidden" name="manager_id" value="{{ task.manager.id }}" required>
                <input type="hidden" name="task_id" value="{{ task.id }}" required>
                <input minlength="5" maxlength="50" name="title" type="text" class="form-control mb-2" value="{{ task.title }}" required readonly>
                <textarea minlength="5" rows="5" class="form-control" name="text" id="" required readonly>{{ task.text }}</textarea>
                <hr class="hr mb-2">
                <!-- Срок выполнения задачи -->
                <div class="d-flex">
                  <h6 class="me-2">Срок выполнения задачи.</h6>
                  <div style="cursor:help" data-bs-toggle="tooltip" data-bs-placement="top" title="Дата и время выполнения задачи.">
                    <i class="bi bi-info-circle"></i>
                  </div>
                </div>
                <div class="actual_must_be_completed_by">
                  Текущий срок выполнения задачи: <span style="color: green">до {{ task.must_be_completed_by|date:'d.m.Y H:i' }}</span>
                </div>
                <div required class="datetime-for-task-container d-flex flex-column align-items-start justify-content-end d-none">
                  <label for="must_be_completed_by"><h6 class="mb-1">Изменить срок</h6></label>
                  <input required type="datetime-local" name="must_be_completed_by" id="must_be_completed_by" class="flatpickr w-50 form-control" placeholder="выбрать дату">
                </div>
                <!-- Срок выполнения задачи end-->
                <hr class="hr my-3">

                <!-- Оповещение о сроках -->
                <div class="d-flex">
                  <h6 class="me-2">Оповещение о сроке выполнения</h6>
                  <div style="cursor:help" data-bs-toggle="tooltip" data-bs-placement="top" title="Оповещение о сроках выполнения задачи (за день, за час, и в момент окончания срока исполнения).">
                    <i class="bi bi-info-circle"></i>
                  </div>
                </div>
                <div class="actual_notifications_status">
                {% if task.notifications %}<span style="color: green">Включено</span>{% else %}<span style="color: red">Выключено</span>{% endif %}
                </div>
                <label class="switch-1 d-flex align-items-center justify-content-start d-none">
                  <div class="">Выключить</div> 
                  <input name="notifications" type="checkbox" />
                  <span class="check-slider-1 mx-2"></span>
                  <div class="">Включить</div> 
                </label>
                <!-- Оповещение о сроках end-->

                
                <!-- Срок выполнения задачи end-->

                <div style="color: red; font-weight: 600;" class="update-task-error-place mt-2"></div>
                <hr class="hr">
                <button type="submit" class="verg-button-green save-task-changes d-none">Сохранить изменения</button>
                <button type="button" class="btn btn-secondary cancel-task-changes d-none" data-bs-dismiss="modal">Отменить</button>
            </form>
            <button id="editTaskForRequest" class="verg-button-1 border-0">Редактировать</button>

            <hr class="hr delete-task-hr d-none">
            <button data-delete-url="{% url 'crm:delete_task_for_request' %}" data-task-id="{{task.id}}" id="deleteTask" class="verg-button-danger d-none">Удалить задачу</button>

        </div>
      </div>
    </div>
    <script src="{% static 'crm/js/task-for-request-detail.js' %}"></script>
</div>
