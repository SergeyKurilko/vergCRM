# vergCRM

## Описание

### Приложение для работы с заявками на окозание услуг.

Это веб-приложение на Django для работы с заявками на окозание услуг.
Оно позволяет создавать заявки, ставить задачи, создавать напоминания, вести учет заказчиков, расчитывать стоимость работ и т.д.

## Содержание

1. [Описание](#Описание)
2. [Функциональность](#функциональность)
3. [Технологии](#технологии)
4. [Установка](#установка)
5. [Использование](#использование)
6. [Контакты](#контакты)

## Функциональность

- Добавление заявки: заполнение формы создания заявки, выбор услуги, клиента и описание детаоей.
- Заполнение заявки: добавление файлов для заявки, указание адреса, расчет себестоимости и стоимости, постановка задач.
- Создание задач: создание задач в карточке заявки, а так же создание самостоятельных задач с выбором срока выполнения и описанием сути.
- Добавление напоминания: при создании задачи, выбор вида напоминания (разовое или повторяющееся) и параметров напоминиаий (дата и время напоминаний).
- Учет клиентов: отдельная страница "Клиенты", позволяющая просматривать, добавлять, редактировать и удалять карточки клиентов.
- Учет заявок: отдельная страница "Заявки", позволяющая просматривать, добавлять, редактировать и удалять карточки заявок.
- Учет задач: отдельная страница "Задачи", позволяющая просматривать, добавлять, редактировать и удалять задачи.
- Получение напоминаний о задаче: получение настроенных напоминаний о задаче в telegram и в браузер.
- Получение оповещений о сроках выполнения задачи: получение в telegram и браузер напоминаний о сроках выполнения задачи: за сутки, за час и в момент окончания срока выполнения.

## Технологии

- **Python 3.10**
- **Django 5.1:** Основной фреймворк.
- **Django REST Framework 3.16:** Для API.
- **django-celery-beat 2.7.0:** Для работы периодических задач.
- **celery:** Для организации распределенной очереди задач.
- **redis:** Брокер для очередей задач.
- **pyTelegramBotAPI:** Для телеграм бота. Отправка напоминаний и оповещений о сроках задач.
- **aiohttpЖ** Для взамиодействия telegram-бота с API приложения.
- **python-dotenv:** Для использования переменных окружения.
- **HTML/CSS/JavaScript:**: Для фронтенда.
- **Bootstrap 5:** Для стилизации.
- **Jquery 3.7.1:** Для ajax запросов и фронтенда.

## Установка

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/SergeyKurilko/vergCRM
   ```
2. Перейдите в каталог vergCRM

   ```bash
   cd vergCRM
   ```
3. Создайте виртуальное окружение и активируйте его:

   ```bash
   python3 -m venv venv
   source venv/bin/activate 
   ```
4. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```
5. Создайте в каталоге проекта переменную .env для хранения переменных окружения и заполните его. Для работы приложения необходимо описать следующие переменные в .env:

   ```
   BOT_TOKEN=<токен вашего телеграм бота>
   X_API_KEY=<сгенерируйте уникальный ключ (str)>

   BASE_URL=<https://IP или доменное имя>
   SECRET_KEY=<django secret key>

   ALLOWED_HOSTS="127.0.0.1, "
   DEBUG=True или False

   DB_NAME=<имя базы данных>
   DB_USER=<имя пользователя базы данных>
   DB_PASS=<пароль от базы данных>
   DB_HOST=<хост базы данных>
   DB_PORT=<порт базы данных>
   ```

   - Генерирование SECRET_KEY:
     В терминале, находясь в каталоге, где расположен manage.py, введите по порядку

     Запуск интерактивной консоли Django

     ```bash
     python manage.py shell
     ```

     Импортирование utils

     ```
     from django.core.management import utils
     ```

     Генерирование ключа

     ```
     utils.get_random_secret_key()
     ```
6. Создайте и выполните миграции:

   ```bash
   python manage.py makemigrations
   python manage.py migrate
   ```
7. Создайте суперпользователя:

   ```bash
   python manage.py createsuperuser
   ```
8. Разместите приложение на сервере и запустите его (используя nginx и gunicorn, или любым другим способом).
9. Для работы celery worker и celery beat запустите фоновым процессом:

```
celery -A vergCRM worker
celery -A vergCRM beat
```

10. Для работы telegram-бота перейдите в каталог `telegram_bot/main_bot` и запустите фоновым процессом:

```
python3 async_bot.py
```

## Использование

Видеодемонстрация использования приложения:

[Видеообзор приложения vergCRM](https://rutube.ru/video/099c005eaa9fca085f441d49c5f766ae/?r=a)

## Контакты

email: kurservlad@yandex.ru
telegram: @Devidbrown
